# Section 5: 品質保証 教材リファレンス

## Section 5-1: 開発標準・テスト・CI

### レッスン内容

- 開発標準
- 静的解析ツール
- ソフトウェアのテストとは
- テストコード・テストフレームワーク
- TDD
- カバレッジ管理
- CI

### 課題

- 家計簿アプリに品質管理のための各ツールや開発プロセスを導入する

### 参考URL（開発標準）

- [Microsoft TypeScript Coding Guidelines](https://github.com/microsoft/TypeScript/wiki/Coding-guidelines)
- [Airbnb JavaScript Style Guide](https://github.com/airbnb/javascript)
- [Google TypeScript Style Guide](https://google.github.io/styleguide/tsguide.html)

---

### 開発標準

開発標準は、システムの開発時に従うべきルールとスタイルガイド。組織やプロジェクト単位で固有のルールがある場合が多い。

#### 開発標準を設けるメリット

- **可読性の向上**: コードに一貫性を持たせることで、読みやすいコードになる
- **不具合の回避**: アンチパターンや誤解を招きやすい記法をルールで回避できる
- **開発効率の向上**: 書き方で迷うことが減り、コードレビューもスムーズになる

※開発標準は新規に作成する必要性は低く、既存のルールを適用することが多い。

---

### 静的解析ツール

プログラムを実行することなくソースコードを解析し、様々な問題点やバグ、セキュリティの脆弱性などを検出するために使用されるツール。

#### ESLint

JavaScript および TypeScript 向けの静的解析ツール。コーディングスタイルの問題や潜在的なエラーを自動で検出する。Prettierなどのフォーマッターと併せて利用されることが多い。

---

### ソフトウェアのテストとは

作成したアプリケーションが仕様通りに正しく動作することを確認するプロセス。

#### テストの種類

| 種類 | 説明 |
|------|------|
| **単体テスト** | 個々の関数やメソッドが正しく動作するかを確認するテスト |
| **統合テスト** | 複数のコンポーネントやモジュールが連携して正しく動作するかを確認するテスト |
| **導入テスト** | システム全体がエンドユーザーの期待通りに動作するかを確認するテスト |

#### テスト設計の例

関数 `updateUser` のテスト観点:

```tsx
type User = {
  id: string
  name: string
  age: number
}

const updateUser = (user: User) => {
  // do something.
}
```

確認すべき項目:
- 指定したユーザがDBに存在しない場合、「User's id is invalid.」という例外を投げること
- idは50桁のハッシュ値であること
- nameは2文字以上55文字以下であること
- ageは自然数であること

---

### テストコード・テストフレームワーク

テストコードとはプログラムが正しく動作するかを確認するためのコード。テストフレームワークはテストケースの設計・作成・実行を支援するツール。

#### Jest（ts-jest）

Facebook（Meta）社によって開発されたJavaScriptおよびTypeScriptのテストフレームワーク。テストカバレッジも測定可能。TypeScript向けに `ts-jest` がある。

#### Vitest

Jest互換でより高速なテストフレームワーク。最近使われるケースが増えている。

参考: [Vitest](https://vitest.dev/)

#### E2Eテスト（End to End）

アプリケーションがエンドユーザーに提供される全体的な動作や機能を検証するための品質保証プロセス。ユーザーの視点からシステム全体が正しく動作するかを確認する。

主なフレームワーク: Cypress, Playwright, Puppeteer

---

### TDD（テスト駆動開発）

テスト駆動開発（Test-Driven Development）は、テストを先に書き、そのテストが通るようにプログラムを実装していく手法。

#### TDDの利点

- 要件や仕様の明確化
- 開発初期に不具合を発見しやすい
- リファクタリングが容易

#### TDDのプロセス

1. **テストの作成**: 実装したい機能に対するテストコードを書く。テストを実行し、失敗することを確認する
2. **最小限のコードの実装**: テストが通過するための最小限のコードを実装する
3. **リファクタリング**: テストが通った最小限のコードをリファクタリングする。可読性や拡張性・再利用性の向上を目指す

---

### カバレッジ管理

テストカバレッジとは、テストプロセスがどれだけのコードを網羅し実行しているか、またはどれだけの機能を検証しているかを示す指標。

- **リスクの特定と緩和**: テストカバレッジのデータを分析することで、テストが不十分なコード領域を特定し追加テストを行える
- **優先順位**: 一般的にカバレッジ率が高いことが好ましいがコストとのトレードオフ。ユーザにとってクリティカルな部分や、システムの中核・データの変化が少ない部分から率を上げていくなど優先順位を決める

参考: [ホワイトボックステストのカバレッジの違いを説明できるようになろう - Qiita](https://qiita.com/ms_/items/d117f3cf7a4fa5b9a1bd)

---

### CI（Continuous Integration）

- GitHub Actions上で単体テスト実行（PRマージや本番デプロイ前の確認等に使用）
- GitHub Actionsの他にCI/CD専用のCircleCIやTravisCIといったものがある

---

### 課題（Must）

- ESLint, Prettierを導入する（VSCodeの拡張機能も活用）
- vitestを利用して関数やAPIのテストコードを書く
  - `npm run test` でテストを実行できるようにする
  - 正常系・異常系それぞれでテスト設計する
  - テストを通るようなコードに修正する

### 課題（Advanced）

- E2Eのテストシナリオを作成する（マークダウンやスプレッドシートなどでテストを設計）
- Playwrightを利用してE2Eテストを実施する
- 家計簿アプリのカバレッジ率を算出する

---

### 課題提出

- タスクごとにブランチとPRを作成し、セルフレビューしてmainにマージする
- リポジトリのURLをDiscordで共有してレビュー依頼
- Section 5-5の課題提出タイミングまでに提出
